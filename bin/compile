#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>

### Configure environment

set -o errexit    # always exit on error

### Configure directories

BUILD_DIR=${1:-}
CACHE_DIR=${2:-}
ENV_DIR=${3:-}
BP_DIR=$(cd "$(dirname "${0:-}")"; cd ..; pwd)

cd $BUILD_DIR

echo "- node_modules"
mkdir -p "$(dirname "$BUILD_DIR/node_modules")"
mv "$CACHE_DIR/node/cache/node_modules" "$BUILD_DIR/node_modules"

yarn workspace `cat $ENV_DIR/YARN_WORKSPACE` run `cat $ENV_DIR/YARN_RUN_COMMAND`
